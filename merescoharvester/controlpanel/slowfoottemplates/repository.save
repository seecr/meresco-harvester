<%
from merescoharvester.controlpanel.tools import getDomainId
from merescoharvester.controlpanel import RepositoryData

formData = asform(input)
domainId = getDomainId(req.uri)
fileName = args.name
groupId = args.referrerGroup
repositoryData = RepositoryData(formData.id)
repositoryData.repositoryGroupId = formData.repositoryGroupId
repositoryData.use = formData.use
repositoryData.complete = formData.complete
repositoryData.action = formData.repositoryAction
repositoryData.baseurl = formData.baseurl
repositoryData.set = formData.set
repositoryData.collection = formData.collection
repositoryData.targetId = formData.targetId
repositoryData.metadataPrefix = formData.metadataPrefix
repositoryData.mappingId = formData.mappingId

def getShopclosed(i):
    return '%s:%s:%s:00-%s:%s:%s:00' % (
        formData.getfirst('shopclosedWeek_%s' % i),
        formData.getfirst('shopclosedWeekDay_%s' % i),
        formData.getfirst('shopclosedBegin_%s' % i),
        formData.getfirst('shopclosedWeek_%s' % i),
        formData.getfirst('shopclosedWeekDay_%s' % i),
        formData.getfirst('shopclosedEnd_%s' % i)
    )

for i in range(1,1+int(formData.numberOfTimeslots)):
    if formData.get('deleteTimeslot_%s.x' % i, None) == None:
        repositoryData.shopclosed.append(getShopclosed(i))

if formData.get('addTimeslot', None) != None:
    repositoryData.shopclosed.append(getShopclosed(0))

repositoryData.save(filepath(fileName))
redirect('/page/repository.edit/' + fileName + '?referrerGroup='+groupId)
%>
